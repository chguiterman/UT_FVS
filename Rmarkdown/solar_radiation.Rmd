---
title: "Radiation index"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
library(tidyverse)
```


## Project

I'm using tree rings and forest inventory data to update tree growth models in Utah. The current growth models use a multiple regression with the following variables:

* SICOND: species site index on a 50-year age basis
* ASPECT: stand aspect
* SLOPE: stand slope
* DIA_C: tree diameter at breast height
* BAL: total basal area in trees larger than the subject tree
* CR_weib: tree's live crown ratio expressed as proportion
* PCCF: crown competition factor on the subplot level
* CCF: stand crown competition factor

The updated model will use tree rings to build an annual growth model and incorporate in climate variables:

* Temperature: based on seasonal correlation with RWI
* Precipitation: most likely 16-month (previous June through current September) total

There will be an additional updated model that will be reduced based on collinearity and significance of variables. One idea for the reduced model is to collapse the parameters that deal with the effect of solar radiation on tree growth, `sin(ASPECT - 0.7854) * SLOPE` and `cos(ASPECT - 0.7854) * SLOPE`, into one parameter. [GRASS r.sun](https://grass.osgeo.org/grass76/manuals/r.sun.html) might be able to do this, but there are some things that need to happen on my end and the FS end.


## Data

In my data set, I have 318 trees from Utah, which are associated with FIA plot locations. The location data from the FIADB I have is 'fudged,' so I will need to write up the analysis in a way that I can hand it off to my FS collaborator, John D Shaw (john.d.shaw@usda.gov), and he can load the correct coordinates, hit run, and send me the results.

Here's the dummy data I'm guessing I would use:

```{r}
tre_loc <- read.csv("/home/courtney/Documents/Masters/Research/Utah/UT_FVS/data/formatted/tre_loc.csv")
head(tre_loc)
```


## Expected result

I would want solar radiation over a specified time period, probably 1958 - 1997, for each tree. My collaborators are leaning towards a seasonal radiation value for each year of growth. Could I get monthly values for each year in the specified time period, and calculate my own seasonal or annual values? Is aggregating radiation an average?

```{r} 
rad_res <- tre_loc %>%
  select(PLT_CN,TRE_CN) %>%
  mutate(Year = NA, #each tree would have 1958 to present
         rad_Jan = NA,
         rad_Feb = NA) #and so on till Dec
head(rad_res)
```

Later on, I'll validate my model with other trees in Utah, which were measured after 2000. If r.sun creates a raster, should the raster be 1958 - present? Then, when I know my testing set trees, John can extract radiation data easily for those trees.

## Code?

```{r}
#load data
#training set
```

```{r}
#create raster of solar radiaion over Utah
#monthly from 1958 - present
#extract solar radiation for each tree in training set
```

```{r}
#possibly at a later date
#load testing set
#extract solar radiation for each tree in testing set
```

```{r}
#remove location
#save file
```


